"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),_lodash=require("lodash"),_lodash2=_interopRequireDefault(_lodash),_assert=require("assert"),_assert2=_interopRequireDefault(_assert),_cryptoJsMd5=require("crypto-js/md5"),_cryptoJsMd52=_interopRequireDefault(_cryptoJsMd5),_request=require("request"),_request2=_interopRequireDefault(_request),_methodsJs=require("./methods.js"),_methodsJs2=_interopRequireDefault(_methodsJs),f=function(){},Wykop=function(){function e(t,r){var a=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],s=a.output,o=a.format,u=a.timeout,n=void 0===u?3e4:u,i=a.useragent,l=void 0===i?"WypokAgent":i,d=a.userkey,f=a.info;_classCallCheck(this,e),_assert2["default"](t&&r,"appkey and secretkey cannot be null"),Object.assign(this,{appkey:t,secretkey:r,output:s,format:o,timeout:n,useragent:l,userkey:d,info:f})}return _createClass(e,[{key:"get",value:function(t,r){var a=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],s=a.params,o=a.api,u=a.post,n=arguments.length<=3||void 0===arguments[3]?f:arguments[3];_assert2["default"](t&&r,"rtype and rmethod must be String and cannot be null");var i=this.appkey,l=this.secretkey,d=this.userkey,m=this.output,h=this.format,p=this.timeout,c=this.useragent,y=_lodash2["default"](s).isEmpty()?"":s.join("/")+"/",g=e.parseApi({appkey:i,userkey:d,output:m,format:h},o),_=e.parsePostParams(u),v=_.form,k=_.formData,b=_.sortedPost,q="http://a.wykop.pl/"+t+"/"+r+"/"+y+g,P={url:q,method:_lodash2["default"](u).isEmpty()?"GET":"POST",json:!0,timeout:p,headers:{"User-Agent":c,apisign:_cryptoJsMd52["default"](l+q+b).toString()},form:v,formData:k};return new Promise(function(e,t){_request2["default"](P,function(r,a,s){r?(t(r),n(r)):a.statusCode>=200&&a.statusCode<300?s.error?(n(s.error),t(s.error)):(n(null,s),e(s)):(t(a),n(a))})})}},{key:"login",value:function(t){var r=arguments.length<=1||void 0===arguments[1]?f:arguments[1];_assert2["default"](t,"accountkey cannot be null");var a=this.appkey,s=this.secretkey,o=this.output,u=this.format,n=this.timeout,i=this.useragent;return this.get("User","Login",{post:{accountkey:t}}).then(function(t){var l=t.userkey,d=new e(a,s,{output:o,format:u,timeout:n,useragent:i,userkey:l,info:t});return r(null,d),Promise.resolve(d)})}}],[{key:"parseApi",value:function(e,t){Object.assign(e,t);var r=_lodash2["default"](e).omit(_lodash2["default"].isUndefined).omit(_lodash2["default"].isNull).keys();return _lodash2["default"](r).reduce(function(t,a,s){return t+a+","+e[a]+(s===r.length-1?"":",")},"")}},{key:"parsePostParams",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=void 0,r=void 0,a=void 0;return e.embed&&"string"!=typeof e.embed?(r=e,a=function(){var t=_lodash2["default"].omit(e,"embed");return _lodash2["default"](t).omit(_lodash2["default"].isUndefined).omit(_lodash2["default"].isNull).sortBy(function(e,t){return t}).toString()}()):_lodash2["default"](e).isEmpty()?a="":(t=e,a=_lodash2["default"](e).omit(_lodash2["default"].isUndefined).omit(_lodash2["default"].isNull).sortBy(function(e,t){return t}).toString()),{form:t,formData:r,sortedPost:a}}},{key:"createMethods",value:function(){var t=!0,r=!1,a=void 0;try{for(var s,o=function(){var t=s.value;e.prototype[t.name]=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=arguments.length<=1||void 0===arguments[1]?f:arguments[1];return this.get(t.type,t.method,e,r)}},u=_methodsJs2["default"][Symbol.iterator]();!(t=(s=u.next()).done);t=!0)o()}catch(n){r=!0,a=n}finally{try{!t&&u["return"]&&u["return"]()}finally{if(r)throw a}}}}]),e}();Wykop.createMethods(),exports["default"]=Wykop,module.exports=exports["default"];